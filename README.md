# SpringBoot-MyBatis-Project-BomoBomo
ìŠ¤í”„ë§ë¶€íŠ¸-ë§ˆì´ë°”í‹°ìŠ¤ í”„ë¡œì íŠ¸
<br>


## ğŸ–¥ï¸ í”„ë¡œì íŠ¸ ì†Œê°œ
ë² ì´ë¹„ì‹œí„° ë§¤ì¹­ í”Œë«í¼, ì•„ì´ë“¤ì„ ìœ„í•œ ì´ë²¤íŠ¸ ì„œë¹„ìŠ¤ ì œê³µ í”Œë«í¼
<br>


## ğŸ•°ï¸ ê°œë°œ ê¸°ê°„
* 2023.9 - 2023.10

### ğŸ§‘â€ğŸ¤â€ğŸ§‘ ë§´ë²„êµ¬ì„±
 - íŒ€ì¥: ê¹€ì„±ì°¬ : ê´€ë¦¬ì í˜ì´ì§€
 - ë¶€íŒ€ì¥: ë³µì˜í—Œ : ë©”ì¸í˜ì´ì§€, ì»¤ë®¤ë‹ˆí‹°, ì—ëŸ¬í˜ì´ì§€ 
 - íŒ€ì›1: ì„í˜•ì¤€ : ë§ˆì´í˜ì´ì§€
 - íŒ€ì›2: ê³µë³‘ë¬¸ : íšŒì‚¬ì†Œê°œ, ì´ë²¤íŠ¸ í˜ì´ì§€
 - íŒ€ì›3: ì´ì¤‘ê·¼ : ë¡œê·¸ì¸, íšŒì›ê°€ì…, ê³„ì •ì°¾ê¸°, ì”¨í„°ì°¾ê¸°


### âš™ï¸ ê°œë°œ í™˜ê²½
- **IDE** : IntelliJ IDEA
- **Framework** : Springboot(3.x), MyBatis
- **Database** : Oracle DB(11xe)

### ğŸ“Œí¬íŠ¸í´ë¦¬ì˜¤ 

[BOMOBOMO í¬íŠ¸í´ë¦¬ì˜¤.pdf](https://github.com/bokkaa/SpringBoot-BomoBomo/files/14415618/BOMOBOMO.pdf)

## ğŸ“Œ ë‚´ê°€ ë§¡ì€ ê¸°ëŠ¥
#### ë©”ì¸ í˜ì´ì§€ <a href="https://github.com/bokkaa/SpringBoot-BomoBomo/wiki/%EB%A9%94%EC%9D%B8%ED%8E%98%EC%9D%B4%EC%A7%80" >ìƒì„¸ë³´ê¸° - WIKI ì´ë™</a>
- ë² ìŠ¤íŠ¸ ëŒë´„ í›„ê¸° Top6
- ë² ìŠ¤íŠ¸ ì´ë²¤íŠ¸ í›„ê¸° Top6

#### FAQ / ê³µì§€ì‚¬í•­ ê²Œì‹œíŒ <a href="https://github.com/bokkaa/SpringBoot-BomoBomo/wiki/%EA%B3%B5%EC%A7%80%EC%82%AC%ED%95%AD-%EA%B2%8C%EC%8B%9C%ED%8C%90" >ìƒì„¸ë³´ê¸° - WIKI ì´ë™</a>
- FAQ ëª©ë¡
- ê³µì§€ì‚¬í•­ ëª©ë¡
- ê³µì§€ì‚¬í•­ ìƒì„¸ë³´ê¸°

#### ëŒë´„ í›„ê¸° ê²Œì‹œíŒ <a href="https://github.com/bokkaa/SpringBoot-BomoBomo/wiki/%EB%8F%8C%EB%B4%84-%ED%9B%84%EA%B8%B0-%EA%B2%8C%EC%8B%9C%ED%8C%90" >ìƒì„¸ë³´ê¸° - WIKI ì´ë™</a>
- ëŒë´„ í›„ê¸° ëª©ë¡
- ëŒë´„ í›„ê¸° ìƒì„¸
- ëŒë´„ í›„ê¸° ìˆ˜ì • ì‚­ì œ
- ëŒ“ê¸€ ê¸°ëŠ¥

#### ì´ë²¤íŠ¸ í›„ê¸° ê²Œì‹œíŒ <a href="https://github.com/bokkaa/SpringBoot-BomoBomo/wiki/%EC%9D%B4%EB%B2%A4%ED%8A%B8-%ED%9B%84%EA%B8%B0-%EA%B2%8C%EC%8B%9C%ED%8C%90" >ìƒì„¸ë³´ê¸° - WIKI ì´ë™</a>
- ì´ë²¤íŠ¸ í›„ê¸° ëª©ë¡
- ì´ë²¤íŠ¸ í›„ê¸° ìƒì„¸
- ì´ë²¤íŠ¸ í›„ê¸° ìˆ˜ì • ì‚­ì œ
- ëŒ“ê¸€ ê¸°ëŠ¥
#### ì—ëŸ¬ í˜ì´ì§€ <a href="https://github.com/bokkaa/SpringBoot-BomoBomo/wiki/%EC%97%90%EB%9F%AC-%ED%8E%98%EC%9D%B4%EC%A7%80" >ìƒì„¸ë³´ê¸° - WIKI ì´ë™</a>
- ì—ëŸ¬ í˜ì´ì§€


<hr>

## ğŸ“Œì½”ë“œ ìˆ˜ì • 

<details><summary>ì¡°íšŒìˆ˜( ì¿ í‚¤ê°’ ì´ìš© ) - ëª¨ë“ˆí™”</summary>


<img width="811" alt="ì œëª© ì—†ìŒ" src="https://github.com/bokkaa/SpringBoot-BomoBomo/assets/77730779/5398ee8d-b7ef-4207-b403-d47504ea8fd9">


```java

//ëŒë´„í›„ê¸° ìƒì„¸ë³´ê¸°
    @GetMapping("/reviewDetail")
    public String showServiceReviewDetailPage(@RequestParam("sitterBoardNumber") Long sitterBoardNumber,
                                               Model model, HttpServletRequest req, HttpServletResponse resp){



        SitterBoardVo sitterBoardVo = reviewService.selectOne(sitterBoardNumber);
        List<SitterBoardVo> sitterBoardVoList = reviewService.findReviewDetail(sitterBoardVo.getEmpNumber());
        double getAvg = reviewService.getAvgRating(sitterBoardVo.getEmpNumber());


        //ì¡°íšŒìˆ˜ ì¿ í‚¤ ì´ìš©
        Cookie[] cookies = req.getCookies();
        boolean updateCount = true;

        if (cookies != null) {
            for (Cookie cookie : cookies) {
                if ("reviewDetail_count_cookie".equals(cookie.getName())) {
                    String cookieValue = cookie.getValue();

                    String[] values = cookieValue.split("/");
                    log.info("%%%%%%%%%% {}", Arrays.toString(values));

                    List<Long> valueList = Arrays.stream(values).mapToLong(Long::parseLong).boxed().collect(Collectors.toList());

                    if(valueList.contains(sitterBoardNumber)){
                        updateCount = false;
                        break;
                    }

                    valueList.add(sitterBoardNumber);
                    log.info("##############3 {}", valueList);

                    String result = String.join("/", valueList.stream().map(ele -> ele+"").collect(Collectors.toList()));

                    log.info("**************************** {}", result);
                    cookie.setValue(result);
                    resp.addCookie(cookie);
                    updateCount = false;
                    reviewService.updateCount(sitterBoardNumber);

                }

            }
        }

        if (updateCount) {
            Cookie newCookie = new Cookie("reviewDetail_count_cookie", req.getParameter("sitterBoardNumber"));
            newCookie.setMaxAge(24 * 60 * 60);
            resp.addCookie(newCookie);

            reviewService.updateCount(sitterBoardNumber);
        }


        model.addAttribute("sitterReviewList", sitterBoardVoList);
        model.addAttribute("serviceReviewDetail", sitterBoardVo);
        model.addAttribute("getAvg", (Math.round(getAvg*100) / 100.0));

        log.info(String.valueOf(getAvg));
        log.info(sitterBoardVo.toString());
        log.info(sitterBoardVoList.toString());
        return "board/serviceReviewDetail";
    }

```
- ê¸°ì¡´ì—ëŠ” ëª¨ë“ˆí™” ì—†ì´ ì»¨íŠ¸ë¡¤ëŸ¬ì— ì§ì ‘ ì¿ í‚¤ê°’ì„ ì´ìš©í•˜ì—¬ ê²Œì‹œê¸€ ìƒì„¸ í˜ì´ì§€ì— ì§„ì…í–ˆì„ ì‹œ 24ì‹œê°„ë§ˆë‹¤ í•œ ë²ˆ ì¡°íšŒìˆ˜ 1ì´ ì˜¬ë¼ê°€ë„ë¡ ì„¤ì •í•´ë†“ì•˜ë‹¤.
- ì‘ë™ ì›ë¦¬ëŠ” ê²Œì‹œë¬¼ ìƒì„¸ í˜ì´ì§€ì— ì§„ì…í•  ë•Œë§ˆë‹¤ ê·¸ ê²Œì‹œë¬¼ì˜ IDê°’ì„ ì¿ í‚¤ê°’ìœ¼ë¡œ ì´ì–´ë¶™ì´ëŠ” í˜•ì‹ìœ¼ë¡œ í•´ë‹¹ ì¿ í‚¤ê°’ì— ê²Œì‹œë¬¼IDê°€ ì¡´ì¬í•œë‹¤ë©´ ì¡°íšŒìˆ˜ê°€ ì˜¬ë¼ê°€ì§€ ì•ŠëŠ”ë‹¤.
- ë¬¸ì œëŠ” ê²Œì‹œë¬¼ ìƒì„¸ í˜ì´ì§€ë¡œ ì§„ì…í•˜ëŠ” ë§¤í•‘ì´ 3-4ê°œëŠ” ë˜ì—ˆê³  ì´ ì½”ë“œë¥¼ ê·¸ëŒ€ë¡œ ê°ê°ì˜ ë§¤í•‘ ì»¨íŠ¸ë¡¤ëŸ¬ì— ë°˜ë³µì ìœ¼ë¡œ ì‚¬ìš©í•˜ê¸°ì—ëŠ” ê°€ë…ì„±ì€ ë¬¼ë¡  ìœ ì§€ë³´ìˆ˜ì—ë„ ì•ˆ ì¢‹ì„ë“¯í•˜ì—¬ ëª¨ë“ˆí™”ë¥¼ ì‹œë„í•´ë³´ì•˜ë‹¤.


<details><summary>ìˆ˜ì •ì½”ë“œ</summary>

```java

//ì¡°íšŒìˆ˜ ì¿ í‚¤ ë©”ì†Œë“œ ëª¨ë“ˆí™”
public class CookieHandler {

    private final NoticeService noticeService;
    private final ReviewService reviewService;


    /**
     * ì¿ í‚¤ ì²˜ë¦¬
     * @param req HttpServletRequest ê°ì²´
     * @param resp HttpServletResponse ê°ì²´
     * @param number IDê°’
     * @param name ì¿ í‚¤ ì´ë¦„ê°’
     */
    public void handleCookies(HttpServletRequest req, HttpServletResponse resp, Long number, String name) {
        // í˜„ì¬ ìš”ì²­ì—ì„œ ì¿ í‚¤ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.
        Cookie[] cookies = req.getCookies();
        boolean updateCount = true;

        if (cookies != null) {
            for (Cookie cookie : cookies) {
                // ì¿ í‚¤ì˜ ì´ë¦„ì´ ì£¼ì–´ì§„ ì´ë¦„ê³¼ ì¼ì¹˜í•˜ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.
                if (name.equals(cookie.getName())) {
                    // ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì¿ í‚¤ë¥¼ ì²˜ë¦¬í•©ë‹ˆë‹¤.
                    handleExistingCookie(cookie, number, req, resp, name);
                    updateCount = false;
                    break;
                }
            }
        }
        if (updateCount) {
            // ì¿ í‚¤ê°€ ì¡´ì¬í•˜ì§€ ì•Šì„ ê²½ìš° ìƒˆë¡œìš´ ì¿ í‚¤ë¥¼ ìƒì„±í•˜ê³  ì¶”ê°€í•©ë‹ˆë‹¤.
            createAndAddNewCookie(req, resp, number, name);
        }
    }

    

    /**
     * ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì¿ í‚¤ë¥¼ ì²˜ë¦¬í•˜ëŠ” ë©”ì„œë“œ
     * @param cookie cookie ê°ì²´
     * @param number IDê°’
     * @param req HttpServletRequest ê°ì²´
     * @param resp HttpServletResponse ê°ì²´
     * @param name ì¿ í‚¤ ì´ë¦„ê°’
     */
    private  void handleExistingCookie(Cookie cookie, Long number, HttpServletRequest req, HttpServletResponse resp, String name) {
        String cookieValue = cookie.getValue();
        String[] values = cookieValue.split("/");
        log.info("%%%%%%%%%% {}", Arrays.toString(values));

        List<Long> valueList = Arrays.stream(values).map(Long::parseLong).collect(Collectors.toList());

        // ë²ˆí˜¸ê°€ ì´ë¯¸ ì¡´ì¬í•˜ë©´ ë©”ì„œë“œë¥¼ ì¦‰ì‹œ ì¢…ë£Œí•©ë‹ˆë‹¤.
        if (valueList.contains(number)) {
            return;
        }

        // ë²ˆí˜¸ê°€ ì¡´ì¬í•˜ì§€ ì•Šìœ¼ë©´ ìš”ì²­í•œ ì‚¬ì´íŠ¸ì˜ ê²Œì‹œë¬¼ ë²ˆí˜¸ë¥¼ ë¦¬ìŠ¤íŠ¸ì— ì¶”ê°€í•©ë‹ˆë‹¤.
        valueList.add(number);
        log.info("############### {}", valueList);

        // ë¦¬ìŠ¤íŠ¸ì— ì¶”ê°€í•œ ê°’ë“¤ì„ í•˜ë‚˜ì˜ ë¬¸ìì—´ë¡œ ê²°í•©í•©ë‹ˆë‹¤.
        String result = String.join("/", valueList.stream().map(Object::toString).collect(Collectors.toList()));
        log.info("**************************** {}", result);
        cookie.setValue(result);
        resp.addCookie(cookie);

        // ì¿ í‚¤ ì´ë¦„(name)ì— ë”°ë¼ ì´ë²¤íŠ¸ ë¦¬ë·° ê²Œì‹œíŒ, ëŒë´„ ì„œë¹„ìŠ¤ ë¦¬ë·° ê²Œì‹œíŒ ë˜ëŠ” ê³µì§€ì‚¬í•­ ê²Œì‹œíŒì„ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.
        if ("eventReviewDetail_count_cookie".equals(name)) {
            reviewService.updateEventReviewCount(number);
        } else if ("reviewDetail_count_cookie".equals(name)) {
            reviewService.updateCount(number);
        } else if ("notice_count_cookie".equals(name)) {
            noticeService.updateCount(number);
        }
    }


    /**
     * ìƒˆë¡œìš´ ì¿ í‚¤ë¥¼ ìƒì„±í•˜ê³  ì¶”ê°€í•˜ëŠ” ë©”ì„œë“œ
     * @param req HttpServletRequest ê°ì²´
     * @param resp HttpServletResponse ê°ì²´
     * @param number IDê°’
     * @param name ì¿ í‚¤ ì´ë¦„ê°’
     */
    private  void createAndAddNewCookie(HttpServletRequest req, HttpServletResponse resp, Long number, String name) {
        Cookie newCookie = new Cookie(name, String.valueOf(number));
        newCookie.setMaxAge(24 * 60 * 60); // ì¿ í‚¤ì˜ ìµœëŒ€ ìˆ˜ëª…ì„ ì„¤ì •í•©ë‹ˆë‹¤ (24ì‹œê°„)
        resp.addCookie(newCookie);

        // ì¿ í‚¤ ì´ë¦„(name)ì— ë”°ë¼ ì´ë²¤íŠ¸ ë¦¬ë·° ê²Œì‹œíŒ, ëŒë´„ ì„œë¹„ìŠ¤ ë¦¬ë·° ê²Œì‹œíŒ ë˜ëŠ” ê³µì§€ì‚¬í•­ ê²Œì‹œíŒì„ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.
        if ("eventReviewDetail_count_cookie".equals(name)) {
            reviewService.updateEventReviewCount(number);
        } else if ("reviewDetail_count_cookie".equals(name)) {
            reviewService.updateCount(number);
        } else if ("notice_count_cookie".equals(name)) {
            noticeService.updateCount(number);
        }
    }
}

.
.
.

// ê²°ê³¼ì ìœ¼ë¡œ ê°ê°ì˜ ë§¤í•‘ ì»¨íŠ¸ë¡¤ëŸ¬ì—ëŠ” 
// ë‹¤ìŒê³¼ ê°™ì€ ì½”ë“œë§Œ ì¶”ê°€í•˜ë©´ ê°™ì€ ê¸°ëŠ¥ì„ êµ¬í˜„í•  ìˆ˜ ìˆê²Œ ë˜ì—ˆë‹¤.

       //ì¡°íšŒìˆ˜ ì¦ê°€
        CookieHandler cookieHandler = new CookieHandler(noticeService, reviewService);
        cookieHandler.handleCookies(req, resp, eventBoardNumber, "eventReviewDetail_count_cookie");

```

</details> 

</details>

<hr>

## ğŸ“ŒëŠë‚€ì 

ì •ì‹ìœ¼ë¡œ JPA ìˆ˜ì—…ë„ ë“¤ì—ˆë˜ ê²ƒì´ ì•„ë‹ˆê³  ì¸í”„ëŸ°ì—ì„œ JPA ê´€ë ¨ ê°•ì˜ ë‘ ê°œë¥¼ ë“¤ìœ¼ë©° ì‹œì‘í–ˆë˜ í”„ë¡œì íŠ¸ì˜€ë‹¤. ê·¸ ìƒíƒœë¡œ ì²˜ìŒ í”„ë¡œì íŠ¸ë¥¼ ì‹œì‘í–ˆì„ ë•Œ, ë¹Œë” íŒ¨í„´ì—ì„œ ë§‰íˆê¸° ì‹œì‘í–ˆë‹¤. ê·¸ë˜ì„œ ë¹Œë” íŒ¨í„´ì€ ë¬´ì—‡ì´ê³  ë¹Œë” íŒ¨í„´ì€ ì™œ ì‚¬ìš©í•˜ëŠ”ì§€ ë“±ì„ ì´ëŸ° ì €ëŸ° ìë£Œë¥¼ ì°¾ì•„ë³´ë©° í”„ë¡œì íŠ¸ì— ì ìš©í•˜ê¸° ì‹œì‘í–ˆë‹¤.  

í”„ë¡œì íŠ¸ë¥¼ ì§„í–‰í•˜ë©° JPAì—ì„œ ê²½ê³„í•´ì•¼í•˜ëŠ” N+1 ë¬¸ì œê°€ ì¼ì–´ë‚œ ì ì´ í•œ ë²ˆ ìˆì—ˆë‹¤. ë³´í†µ N+1ì´ í„°ì§€ëŠ” ì´ìœ ëŠ” íŠ¹íˆ ForEach(ë¹ ë¥¸ forë¬¸) ì•ˆì—ì„œ ì¿¼ë¦¬ê°€ ê°œìˆ˜ë§Œí¼ ë” ëŒì•„ê°€ëŠ” ê²½ìš°ì˜€ê³ , ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ ì •ë³´ë¥¼ í•˜ë‚˜ì˜ ì¿¼ë¦¬ë¡œ ë°ì´í„°ë¥¼ ì¡°íšŒí•˜ê±°ë‚˜ ì—¬ëŸ¬ ì¿¼ë¦¬ë¡œ ì¡°íšŒí•˜ì—¬ ìŠ¤íŠ¸ë¦¼ì„ í†µí•´ ë§¤í•‘ì„ í•˜ì˜€ë‹¤. 

ê·¸ëŸ°ë° í•œ ê°€ì§€ ë¬¸ì œê°€ ìˆì—ˆëŠ”ë° ì—”í‹°í‹° ê´€ê³„ê°€ OneToOneì¸ ê²½ìš° ìë™ì ìœ¼ë¡œ ìœ ë‹ˆí¬ í‚¤ê°€ ì„¤ì •ë˜ì–´ ì‚­ì œ í›„ ìˆ˜ì • ë¡œì§ì´ ë“¤ì–´ê°€ëŠ” ê¸°ëŠ¥ì„ êµ¬í˜„í–ˆì„ ì‹œ ì—ëŸ¬ê°€ ë°œìƒí–ˆë‹¤. ë•Œë¬¸ì— ì–´ì©” ìˆ˜ ì—†ì´ OneToOne ê´€ê³„ì§€ë§Œ OneToMany , ManyToOneìœ¼ë¡œ ê´€ê³„ë¥¼ ì„¤ì •í•´ì•¼ë§Œ í–ˆë‹¤.

ê¹Œë‹¤ë¡­ë‹¤ë©´ ê¹Œë‹¤ë¡œìš´ ì´ ORM ê¸°ìˆ ì„ í•œ ë²ˆ ì‚¬ìš©í•´ë³´ë‹ˆ ì¥ì ì€ ëª…í™•í–ˆë‹¤. ì¼ë‹¨ JAVAê°€ ì¼ì¢…ì˜ ì£¼ì¸ì´ ë˜ì–´ JAVA ì½”ë“œë¡œ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ê´€ë¦¬í•  ìˆ˜ ìˆë‹¤ëŠ” ì ì´ ê°€ì¥ í° ì¥ì ì´ ì•„ë‹ê¹Œ ì‹¶ë‹¤. 

